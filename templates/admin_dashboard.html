{% extends 'layout.html' %}
{% block content %}
<div class="container mt-4">
  <h1 class="mb-5 text-center">Admin Dashboard</h1>

  <!-- Welcome Message -->
  <div class="alert alert-info text-center">
    Welcome, {{ current_user.username }} ({{ current_user.email }})
  </div>

  <!-- Pending Articles Section -->
  <div class="mb-5">
    <h3 class="mb-3 text-primary">Pending Articles</h3>
    {% if articles %}
      {% for article in articles %}
        <div class="card mb-3 shadow-sm">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <strong>
                <a href="{{ url_for('view_article', article_id=article.id) }}">
                  {{ article.title }}
                </a>
              </strong><br>
              <small>by {{ article.author }}</small>
            </div>
            <div>
              <a href="{{ url_for('approve_article', article_id=article.id) }}" class="btn btn-sm btn-success">Approve</a>
              <a href="{{ url_for('disapprove_article', article_id=article.id) }}" class="btn btn-sm btn-danger">Disapprove</a>
            </div>
          </div>
          <div class="card-body">
            {{ article.content[:250] }}...
            <div class="mt-2">
              <a href="{{ url_for('view_article', article_id=article.id) }}" class="btn btn-sm btn-outline-primary">Read Full Article</a>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted">No pending articles.</p>
    {% endif %}
  </div>

  <!-- Approved Articles Section -->
  <div>
    <h3 class="mb-3 text-success">Approved Articles</h3>
    {% if approved_articles %}
      {% for article in approved_articles %}
        <div class="card mb-3 shadow-sm border-success">
          <div class="card-header bg-success text-white">
            {{ article.title }} by {{ article.author }}
          </div>
          <div class="card-body">
            {{ article.content[:250] }}...
            <div class="mt-2">
              <a href="{{ url_for('view_article', article_id=article.id) }}" class="btn btn-sm btn-outline-primary">Read Full Article</a>
            </div>
            <div>
              <a href="{{ url_for('disapprove_article', article_id=article.id) }}" class="btn btn-sm btn-danger">Delete</a>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-muted">No approved articles yet.</p>
    {% endif %}
  </div>
</div>

<!-- Pagination Controls -->
<nav aria-label="Page navigation">
  <ul class="pagination">
    {% if articles.has_prev %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('admin_dashboard', page=articles.prev_num) }}">Previous</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}

    {% for page_num in articles.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
      {% if page_num %}
        {% if page_num == articles.page %}
          <li class="page-item active"><span class="page-link">{{ page_num }}</span></li>
        {% else %}
          <li class="page-item"><a class="page-link" href="{{ url_for('admin_dashboard', page=page_num) }}">{{ page_num }}</a></li>
        {% endif %}
      {% else %}
        <li class="page-item disabled"><span class="page-link">â€¦</span></li>
      {% endif %}
    {% endfor %}

    {% if articles.has_next %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('admin_dashboard', page=articles.next_num) }}">Next</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
